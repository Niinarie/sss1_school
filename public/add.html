<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>SSS1</title>
  <link rel="stylesheet" type="text/css" href="style.css">
  <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
</head>

<body>
  <ul class="nav">
    <li class="nav__item">
      <a class="nav__link" href="index.html">View</a>
    </li>
    <li class="nav__item">
      <a class="nav__link active" href="">Add</a>
    </li>
    <li class="nav__item">
      <select id="categorySelect">
        <option value="All">All categories</option>
      </select>
    </li>
  </ul>

  <div id="form" class="form center">
    <form id="addForm" action="" method="post">
      <label for="title">Title:</label><br/> 
      <input type="text" name="title"><br/>

      <label for="category">Category:</label><br/>
      <input type="text" name="category"><br/>

      <label for="details">Details</label><br/>
      <input type="text" name="details"><br/>
      
      <label for="time">Date of birth:</label>
      <input type="date" name="time">

      <label for="image">Image:</label><br/>
      <input type="file" name="file">

      <label for="coords">Coordinates:</label><br/>
      <div id="mapCoords" class="map__coords"></div>

      <button type="submit" id="submitForm" class="btn center" value="Submit">Submit</button>
      <input type="text" id="lat" name="lat" hidden>
      <input type="text" id="lng" name="lng" hidden>
    </form>
  </div>

  <script src="./main.js"></script>
  <script>
    var coords = {lat: 60.220622, lng: 24.802490};
    var latField = document.getElementById('lat');
    var lngField = document.getElementById('lng');
    latField.value = coords.lat;
    lngField.value= coords.lng;

    var initCoords = () => {

    var map = new google.maps.Map(document.getElementById('mapCoords'), {
      zoom: 8,
      center: coords,
    });
    var updateTimeout = null;

    var marker = new google.maps.Marker({
          position: coords,
          map: map,
          title: 'Cat location'
    });

    google.maps.event.addListener(map, 'click', function(event) {
      updateTimeout = setTimeout(function() {
        console.log('click');
        const lat = event.latLng.lat();
        const lng = event.latLng.lng();
        
        latField.value = lat;
        lngField.value = lng;

        marker.setPosition({lat, lng});
      }, 200);
    });

    google.maps.event.addListener(map, 'dblclick', function(event) {
      clearTimeout(update_timeout);
    });
  };
  </script>
  <script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAIMmlrlt_CMZicjhBoSwvnzranTS02Ci8&callback=initCoords">
</script>
</body>

</html>